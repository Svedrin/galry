{% extends "base.html" %}
{# kate: space-indent on; indent-width 2; replace-tabs on; #}
{% block head %}
  <link href="http://svedr.in/_rss" rel="alternate" type="application/rss+xml" title="Svedrin's Gallery" />
  <script>
  function body_onload(){
    var albums  = {{ imagejson|safe }};
    var loading = {};
    var albimgs = {};

    var imgloaded = function(){
      if( loading[this.alb].length > 1 ){
        loading[this.alb].pop(this.src);
      }
      else{
        var cnv = document.getElementById('cnv_' + this.alb);
        cnv.style.display = "block";
        var ctx = cnv.getContext('2d');
        if( albimgs[this.alb].length > 0 ){
          ctx.rotate( -10. / 365. * 2 * Math.PI );
          ctx.translate(0, 75);
          ctx.drawImage(albimgs[this.alb][0], 0, 0);
          ctx.setTransform(1, 0, 0, 1, 0, 0);
        }

        if( albimgs[this.alb].length > 1 ){
          ctx.translate(150, 50);
          ctx.drawImage(albimgs[this.alb][1], 0, 0);
          ctx.setTransform(1, 0, 0, 1, 0, 0);
        }

        if( albimgs[this.alb].length > 2 ){
          ctx.rotate( 10. / 365. * 2 * Math.PI );
          ctx.translate(300, -25);
          ctx.drawImage(albimgs[this.alb][2], 0, 0);
          ctx.setTransform(1, 0, 0, 1, 0, 0);
        }
      }
    };

    for(var alb in albums){
      if(albums.hasOwnProperty(alb)){
        albimgs[alb] = [];
        loading[alb] = [];
        for(var i = 0; i < albums[alb].length; i++){
          var img = new Image();
          img.src = "/" + alb + "/thumbs/" + albums[alb][i];
          img.alb = alb;
          img.onload = imgloaded;
          loading[alb].push(img.src);
          albimgs[alb].push(img);
        }
      }
    }
  };
  </script>
{% endblock %}
{% block header %}
  <a href="/">&nbsp;&nbsp;/&nbsp;&nbsp;</a>
{% endblock %}
{% block content %}
  {{ super() }}
  <ul id="albumlist">
  {% for album in albums %}
    <li>{{ album|capitalize }}<br />
      <a href="/{{ album }}">
        <canvas id="cnv_{{ album }}" width="660" height="340" style="display: none"></canvas>
        <noscript>
          <ul id="imagelist">
          {% for img in images[album] %}
            <li><img
              src="/{{ album }}/thumbs/{{ img }}"
              alt="{{ img }}" /></li>
          {% endfor %}
          </ul>
        </noscript>
      </a>
    </li>
  {% endfor %}
  </ul>
{% endblock %}
{% block footer %}
  {{ super() }}
  {{ count }} Image files, {{ size }}MB total
{% endblock %}
